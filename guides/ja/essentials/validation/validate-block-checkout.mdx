---
title: "チェックアウトの検証／ブロック"
description: "指定された条件に基づいて、チェックアウトでエラーを表示したり、無効（または許可されていない）チェックアウトをブロックします。"
icon: "ban"
---

## ルール概要

このルールでは、定義された条件に基づいてチェックアウトプロセスを検証またはブロックできます。カート内容の不正、制限された配送地域、顧客タグ、商品属性の不足などの条件が満たされた場合に、カスタムエラーメッセージを表示したり、チェックアウトを完全に防止できます。

これにより、ビジネスルールを適用し、サポートされていない注文を防ぎ、顧客がチェックアウトを完了する前に問題を解決するよう案内できます。

## サンプル設定

以下の手順では、アプリを使用して **チェックアウトの検証／ブロック** ルールを作成および設定する方法を示します。

### 新しいルールを作成

[ショッピファイ管理画面](/guides/ja/get-started/installation#アプリを開く) からアプリを開きます。サイドバーの [ルール](/guides/ja/get-started/quickstart#サンプルルールを作成) セクションに移動し、_「ルールを作成」_ をクリックします。

次に、**チェックアウトルールタイプ選択画面** にリダイレクトされます。_カテゴリー「検証」→ チェックアウトルールタイプ「チェックアウトの検証／ブロック」→ 「ルールを選択」_ を選びます。

<img
  src="/images/essentials/validation/select-validation-block-rule.webp"
  alt="検証／ブロックルールを選択"
/>

次に、**新しいチェックアウト検証／ブロックルール作成** 画面に移動し、ルールを設定できます。

### ルールの設定

ルールを設定するには、まず任意で「チェックアウトの検証／ブロック」などの名前を付けて、何をするルールかを説明できます。次に、ルールの [ステータス](/guides/ja/get-started/concepts#ステータス) を選択します：テスト、アクティブ、または無効。

ここでは、**テスト** ステータスを選択して、実際の顧客のチェックアウトに影響を与えずにルールをすぐにテストできます。

<img
  src="/images/essentials/validation/rule-configure-1-validation-block-rule.webp"
  alt="ルール設定 1"
/>

同じ画面で、[このルールをトリガー](/guides/ja/get-started/concepts#トリガー) の下から少なくとも1つのオプションを選択します。**チェックアウト操作中** を選ぶと、顧客がチェックアウトプロセス中にルールが実行され、**チェックアウト完了時** を選ぶと、顧客がチェックアウトを完了した際にルールが実行されます。ルールが常に必要な時に実行されるよう、両方のオプションをデフォルトで選択することを推奨します。

<Info>
  ルール設定で何を選ぶべきか不明な場合、デフォルトで事前選択されているオプションが最適な場合が多いです。デフォルトオプションから始めて、後で変更することもできます。
</Info>

<img src="/images/concepts/trigger.webp" alt="トリガー" />

同じ画面で、関連する [条件セット](/guides/ja/get-started/concepts#コンディションセット)、[条件](/guides/ja/get-started/concepts#コンディション（「いつ」）)、および [アクション](/guides/ja/get-started/concepts#アクション（「何を」）) を選択します。

> 例として、**条件セット1** を使用し、ルールを **「住所2行目（アパート、スイート等）」** フィールドが **空の場合** にトリガーするよう設定し、チェックアウトをブロックするよう構成します。エラーメッセージ **「完全な住所を入力してください」** がチェックアウトの **住所2行目** フィールド下に表示され、顧客が完全な住所を入力するまで進めません。

<img
  src="/images/essentials/validation/condition-set-validation-block-rule.webp"
  alt="条件セット"
/>

**アクション** セクションでは、カスタムエラーメッセージをチェックアウトページのどこに表示するか選択できます。ドロップダウンメニューには、表示位置のオプションがリストされています：

- **一般** カテゴリでは、チェックアウトページの最上部にアクションを表示する **「チェックアウトページの上部」** を選択できます。

- **これらの入力フィールドの下** では、特定の入力フィールドの下にアクションを表示することができます。対象フィールド：メール、顧客電話番号、国、名、姓、会社、住所（住所1行目）、アパートメント、都市、州／都道府県、郵便番号、配送先電話番号。

これにより、エラーメッセージを最も適切なチェックアウトフォームの位置に配置できます。

<img
  src="/images/essentials/validation/action-target-dropdown.webp"
  alt="アクション表示位置ドロップダウン"
/>

同じ画面で、アプリがチェックアウト中に問題を起こした場合のシステムの動作を選択します。これはフォールバックオプションで、ほとんどの場合、デフォルトで顧客がチェックアウトを完了できるように設定するのが推奨です。2つのオプションがあります：

- **顧客がチェックアウトを完了できるようにする** ：アプリが問題に遭遇しても、顧客が購入を中断せずに進められることを保証します。

- **顧客がチェックアウトを完了できないようにブロック** ：アプリが失敗した場合、顧客のチェックアウトを停止し、取引を防止します。

希望する顧客体験とリスク許容度に最も合ったオプションを選択してください。

<img src="/images/concepts/fallback.webp" alt="フォールバック" />

最後に、画面上部の <b>保存</b> ボタンをクリックして、ルールを作成および保存します。

<img src="/images/shared/save-rule.webp" alt="ルール保存" />

## ルールのテスト

ルールはテストステータスに設定されているため、チェックアウトでルールを実行するには、実際のメールアドレスの代わりに `test@testing.com` を使用する必要があります。

<Warning>
  以下の画像は、テスト用メールアドレスを使用する <b>前</b> のチェックアウトページを示しています。エラーメッセージはまだ表示されていません。
</Warning>

<img
  src="/images/essentials/validation/before-rule-apply-validation-block-rule.webp"
  alt="ルール適用前"
/>

<Note>
  配送先住所の必須フィールドをすべて入力してください。ショッピファイは、すべての必須フィールドが入力され、顧客が実際にチェックアウト準備ができている場合のみルールを実行します。これにより、入力途中でルールが毎回実行されるのを防ぎます。
</Note>

**住所2行目（アパート、スイート等）** フィールドを空のままにすると、チェックアウトルールが実行され、チェックアウトプロセスがブロックされます。以下のように、エラーメッセージ **「完全な住所を入力してください」** がチェックアウトの **住所2行目** フィールド下に表示されます。

<img
  src="/images/essentials/validation/after-rule-apply-validation-block-rule.webp"
  alt="ルール適用後"
/>

## ルールを有効化

テストが完了したら、ルールを有効化して、実際の顧客のチェックアウトに変更を適用できるようにします。有効化されたルールのみが、すべての顧客のチェックアウトに変更を加えることができます。

サイドバーの **ルール** をクリックしてすべてのルールを表示します。有効化したいルールを選択し、**有効化** ボタンをクリックして有効化します。

<Warning>
  ルールの有効化は有料プランでのみ利用可能です。プランをまだアップグレードしていない場合は、
  [こちら](/guides/ja/get-started/installation#プランをアップグレード) の手順に従ってアップグレードしてください。
</Warning>

<img
  src="/images/essentials/validation/activate-the-rule-validation-block-rule.webp"
  alt="ルールを有効化"
/>
