---
title: "验证/阻止结账"
description: "在给定条件下显示错误或阻止无效（或不允许的）结账。"
icon: "ban"
---

## 规则概述

此规则允许您根据定义的条件验证或阻止结账流程。您可以显示自定义错误消息，或在满足某些条件（如无效的购物车内容、受限的配送地区、客户标签或缺少的产品属性等）时完全阻止结账。

这有助于执行业务规则、防止不支持的订单，并引导客户在完成结账前解决问题。

## 示例配置

以下步骤展示了如何使用应用创建和配置一个 **验证/阻止结账** 规则。

### 创建新规则

从 [Shopify 管理后台](/guides/zh/get-started/installation#前往应用) 打开应用。在侧边栏中，进入 [规则](/guides/zh/get-started/quickstart#创建示例规则) 部分，然后点击 _"创建规则"_。

接着，您将被重定向到 **选择结账规则类型界面**。选择 _类别 "验证" → 选择结账规则类型 "验证/阻止结账" → 点击 “选择规则”_。

<img
  src="/images/essentials/validation/select-validation-block-rule.webp"
  alt="选择验证阻止规则"
/>

然后，您将进入 **创建新的验证/阻止结账规则** 界面，在此可以配置您的规则。

### 规则配置

要配置规则，首先我们可以选择性地添加一个名称，例如 "验证/阻止结账"，以描述其作用。然后，选择规则的 [地位](/guides/zh/get-started/concepts#地位)：测试中、激活或停用。

这里我们选择 **测试中** 地位，这样我们可以快速测试规则，而不会影响实际客户的结账。

<img
  src="/images/essentials/validation/rule-configure-1-validation-block-rule.webp"
  alt="规则配置 1"
/>

接下来，在同一界面下，至少选择一个 [触发此规则](/guides/zh/get-started/concepts#触发器) 选项。您可以选择 **结账时交互**（在客户进行结账时运行规则），以及 **完成结账**（在客户完成结账时运行规则）。默认情况下，您应该同时选择两个选项，以确保规则在需要时始终运行。

<Info>
  如果您不确定应选择哪个规则设置，很多时候默认的预设选项是最佳选择。您可以从默认选项开始，稍后再进行修改。
</Info>

<img src="/images/concepts/trigger.webp" alt="触发器" />

然后，在同一界面下，选择相关的 [条件集](/guides/zh/get-started/concepts#条件集)、[条件](/guides/zh/get-started/concepts#条件（“何时”）) 和 [操作](/guides/zh/get-started/concepts#动作（“做什么”）)。

> 例如，这里我们使用默认的 **条件集 1**，设置规则在 **"地址行 2（公寓、套房等）"** 字段为空时触发，并配置其阻止结账。错误消息 **"请输入完整地址"** 将显示在结账页面的 **地址行 2** 字段下，要求客户提供完整地址后才能继续。

<img
  src="/images/essentials/validation/condition-set-validation-block-rule.webp"
  alt="条件集"
/>

在 **操作** 部分，您可以选择自定义错误消息在结账页面显示的位置。下拉菜单提供了多个放置选项：

- 在 **常规** 分类下，您可以选择 **"结账页面顶部"**，将操作显示在页面最上方。

- 在 **以下输入字段下方** 分类下，您可以选择将操作显示在特定输入字段下方，例如：电子邮件、客户电话号码、国家/地区、名字、姓氏、公司、地址（地址行 1）、公寓、城市、省/州、邮政编码、配送电话号码。

这使您能够控制错误消息显示的位置，帮助您将其放置在结账表单中最相关的部分。

<img
  src="/images/essentials/validation/action-target-dropdown.webp"
  alt="操作目标下拉菜单"
/>

接着，在同一界面下，选择在极少数情况下（如果应用在结账过程中失败或出现问题）系统的行为方式。这是一个回退选项，在大多数情况下，您可能希望允许客户完成结账，这是默认选项。您会看到两个选项：

- **允许客户完成结账**：确保即使应用遇到问题，客户仍然可以顺利完成购买。

- **阻止客户完成结账**：如果应用失败，将阻止客户完成结账，可能会导致交易受阻。

选择与您期望的客户体验和风险容忍度最契合的选项。

<img src="/images/concepts/fallback.webp" alt="回退" />

最后，点击顶部的 <b>保存</b> 按钮来创建并保存您的规则。

<img src="/images/shared/save-rule.webp" alt="保存规则" />

## 测试规则

由于规则设置为测试地位，我们必须使用 `test@testing.com` 作为电子邮件，而不是实际的电子邮件，来在结账时运行规则。

<Warning>
  下图显示了在使用测试电子邮件地址之前的结账页面。请注意，此时错误消息尚未显示。
</Warning>

<img
  src="/images/essentials/validation/before-rule-apply-validation-block-rule.webp"
  alt="规则应用前"
/>

<Note>
  请确保填写配送地址中的所有必填字段。Shopify 仅会在所有必填字段都已填写且客户准备结账时运行规则，以避免在每次输入时触发规则。
</Note>

在将地址行 2（公寓、套房等）字段留空后，结账规则运行并阻止了结账流程。我们可以验证错误消息 **"请输入完整地址"** 已显示在结账页面的 **地址行 2** 字段下，如下所示。

<img
  src="/images/essentials/validation/after-rule-apply-validation-block-rule.webp"
  alt="规则应用后"
/>

## 激活规则

测试完成后，我们可以激活规则，使其开始对实际客户的结账进行更改。只有激活的规则才能对所有客户的结账产生影响。

点击侧边栏中的 **规则** 查看所有规则。选择您想要激活的规则，然后点击 **激活** 按钮来激活它。

<Warning>
  规则激活仅适用于付费计划。如果您尚未升级计划，请按照
  [此处](/guides/zh/get-started/installation#升级您的套餐) 的说明进行升级。
</Warning>

<img
  src="/images/essentials/validation/activate-the-rule-validation-block-rule.webp"
  alt="激活规则"
/>
